# MySQL 설치, 시작 및 종료

### 2.2.1 설정 파일 및 데이터 파일

처음 설치하면 `/etc/my.cnf` 라는 설정 파일을 만들지만 아주 기본적인 것들만 들어있다.

Mysql 서버가 실행되거나 종료될 때는 언제나 mysql server(innoDB 스토리지 엔진)의 버퍼 풀 내용을 백업하고 복구하는 과정이 진행된다.백업은 빠르게 진행되지만 서버가 새로 시작될 때는 디스크에서 데이터 파일들을 모두 읽어서 적재하기 때문에 상당한 시간이 걸린다.

### 2.2.2 서버 시작

```shell
> mysqld --default-file=/tec/my.cnf --initialize-insecure
```

위의 명령어를 이용하면 서버를 구동시킬 수 있다.  허나 위의 명령어는 mysql 서버를 처음 실행시킬때, 다시말해서 기존의 mysql 설정파일들과 로그 파일들이 없을 때 가능하다 말그대로 `initialize` 이기 때문이다.

```
> mysqld
```

기존에 있던 데이터로 다시 서버를 구동하고자 한다면 위의 명령어를 실행한다.

Mysql 은 에러 로그 파일을 기본적으로 `/var/log/mysqld.log`에 저장한다.

### 2.2.3 서버 연결 테스트

```shell
> mysql -uroot -p --host=localhost --socket=/tmp/mysql.sock
> mysql -uroot -p --host=127.0.0.1 --port=3306
> mysql -uroot -p
```

첫번째는 `--socket` 옵션을 통해 소켓 파일로 접속하는 예제이고, 두번째는 `--port` 를 이용해서 TCP/IP를 통해서 접근하는 방법이다. 로컬 서버 말고 원격 인스턴스의 MySQL로 접근하길 원한다면 반드시 두번째 방법을 이용하라.

> MySQL 서버 접속시 호스트를 `localhost` 와 `127.0.0.1`로 명시하는것은 의미가 다르다. 전자는 클라이언트 프로그램이 항상 소켓파일을 통해 접근하는데, 이는 Unix domain socket을 이용하는 방식으로 유닉스 프로세스간 통신(ICP)의 일종이다. 

세번째 방법처럼 아무것도 명시하지 않으면 기본적으로 `localhost` 를 통한 소켓 통신을 이용한다. Mysql 서버를 실행할 때 만들어지는 `mysql.sock` 은 서버를 재시작하지 않는 한 다시 만들수 없기 때문에 실수로 지우는 일이 없어야한다.

간혹 MySQL 서버를 직접 로그인 하지 않고, 원격 서버에서 서버 접속 가능 여부만 확인해야 하는 경우가 있다. 이처럼 연결이 가능한 상태인지만 확인하는 경우 mysql 클라이언트 설치가 번거롭거나 불가능한 경우가 있는데 이런 경우 `telnet` 명령이나 `Netcat` 명령을 이용해서 MySQL 서버가 응답 가능한 상태인지만 확인할 수 있다.

```bash
linux > nc 127.0.0.2 3306
J
8.0.25
 Q0!\�����?@bZ|[OUPAVcaching_sha2_password
```

 위 처럼 글자가 깨져서 정확한 확인은 힘들지만, 설치되어있는 mysql 버전정보를 확인 할 수 있다면, 서버를 정상적으로 연결 가능하다는 뜻이다.

### 2.3.1 MySQL 서버 업그레이드

MySQL 서버 업그레이드는 2가지 경우를 생각해볼 수 있다.

1. Mysql 서버의 데이터는 그대로 두고 업그레이드
2. Mysqldump 도구 등을 이용해서 MySQL 서버의 데이터를 SQL문장이나 텍스트 파일로 덤프한 후, 새로 업그레이드 된 버전의 MySQL 서버에서 덤프된 데이터를 새롭게 적재

AWS를 사용하는 요즘 대부분 RDS, Aurora를 사용하기 때문에 DB업그레이드의 부담으로부터 상대적으로 자유롭다.

### 2.3.2 MySQL 8.x 업그레이드 고려사항

5.x -> 8.x 로 업그레이드 했을때 고려해야할 사항들이 존재한다.

- 사용자 인증 방식 변경 : 8.0 버전부터 `Caching SHA-2 Authentication` 인증 방식이 기존 인증 방식으로 바뀌었다. MySQL 5.7 에 존재했던 사용자 계정은 여전히 `Native Authentication` 방식을 사용할 것이다. 이전 인증방식을 계속 사용하고 싶다면 mysql 서버를 실행할 때 아래의 명령어를 실행한다.

  ```bash
  > mysqld --default-authentication-plugin=mysql_native-password
  ```

- MySQL 8.0 호환성 체크 : MySQL 8.0 업그레이드 전에 MySQL 5.7 버전에서 손상된 FRM 파일이나 호환되지 않는 데이터 타입 또는 함수가 있는지, mysqlcheck 유틸리티를 이용해 확인해 볼 것을 권장한다.

- 외래키 이름의 길이 : 8.0부터 외래키 길이가 64글자로 제한된다.

- 인덱스 힌트 : 5.0 버전에서 사용되던 인덱스 힌트가 있다면, 8.0버전에서 성능테스트가 필요하다.

- GROUP BY 정렬 옵션 : GROUP BY 뒤에 `ASC` 나 `DESC` 를 사용하고 있다면(`GROUP BY field ASC`)다른 방식으로 변경하자

